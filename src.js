function OrderStorage($q){"use strict";var STORAGE_ID="orders-storage",orders=[],_getFromLocalStorage=function(){return angular.fromJson(localStorage.getItem(STORAGE_ID)||"[]")},_saveToLocalStorage=function(orders){localStorage.setItem(STORAGE_ID,angular.toJson(orders))};return{clearCompleted:function(){var deferred=$q.defer(),incompleteOrders=orders.filter(function(order){return!order.completed});return angular.copy(incompleteOrders,orders),_saveToLocalStorage(orders),deferred.resolve(orders),deferred.promise},"delete":function(order){var deferred=$q.defer();return orders.splice(orders.indexOf(order),1),_saveToLocalStorage(orders),deferred.resolve(orders),deferred.promise},get:function(){var deferred=$q.defer();return angular.copy(_getFromLocalStorage(),orders),deferred.resolve(orders),deferred.promise},insert:function(order){var deferred=$q.defer();return orders.push(order),_saveToLocalStorage(orders),deferred.resolve(orders),deferred.promise},put:function(order,index){var deferred=$q.defer();return orders[orders.indexOf(order)]=order,_saveToLocalStorage(orders),deferred.resolve(orders),deferred.promise}}}function RestaurantStorage($q){"use strict";var restaurantData=[{id:0,name:"ThaiVet",menu:[{name:"Wołowina po tajsku",price:"13.99"},{name:"Kaczka po chińsku",price:"17.99"},{name:"Kurzczak curry zielone",price:"12.99"},{name:"Krewetki w pięciu smakach",price:"20.00"}]},{id:1,name:"Greenway",menu:[{name:"Kofta z pieca",price:"16.99"},{name:"Placki z ciecierzycy",price:"15.99"},{name:"Zapiekanka z cukinii",price:"15.99"},{name:"Gulasz z soji",price:"13.00"}]}],STORAGE_ID="restaurant-storage",restaurants=[],_getFromLocalStorage=function(){return angular.fromJson(localStorage.getItem(STORAGE_ID)||"[]")},_saveToLocalStorage=function(restaurantsData){localStorage.setItem(STORAGE_ID,angular.toJson(restaurantsData))};return _saveToLocalStorage(restaurantData),{loadRestaurantsData:function(){var deferred=$q.defer(),incompleteTodos=restaurants.filter(function(todo){return!todo.completed});return angular.copy(incompleteTodos,restaurants),_saveToLocalStorage(restaurants),deferred.resolve(restaurants),deferred.promise},"delete":function(restaurant){var deferred=$q.defer();return restaurants.splice(restaurants.indexOf(restaurant),1),_saveToLocalStorage(restaurants),deferred.resolve(restaurants),deferred.promise},get:function(){var deferred=$q.defer();return angular.copy(_getFromLocalStorage(),restaurants),deferred.resolve(restaurants),deferred.promise},insert:function(restaurant){var deferred=$q.defer();return restaurants.push(restaurant),_saveToLocalStorage(restaurants),deferred.resolve(restaurants),deferred.promise},put:function(restaurant,index){var deferred=$q.defer();return restaurants[restaurants.indexOf(restaurant)]=restaurant,_saveToLocalStorage(restaurants),deferred.resolve(restaurants),deferred.promise}}}function StatusStorage($q){"use strict";var STORAGE_ID="status-storage",status=0,_getFromLocalStorage=function(){return localStorage.getItem(STORAGE_ID||0)},_saveToLocalStorage=function(status){localStorage.setItem(STORAGE_ID,status)};return{get:function(){var deferred=$q.defer();return status=parseInt(_getFromLocalStorage()),deferred.resolve(status),deferred.promise},put:function(status,index){var deferred=$q.defer();return _saveToLocalStorage(status),deferred.resolve(status),deferred.promise}}}function AccountModel($http){"use strict";return{getProfile:function(){return $http.get("http://localhost:3000/api/me")},updateProfile:function(profileData){return $http.put("/api/me",profileData)}}}function AccountService(AccountModel){"use strict";var user=null;return{getUserData:function(){return user?user:AccountModel.getProfile().then(function(response){return user=response.data,response.data})["catch"](function(response){})}}}function LoginCtrl($scope,$location,$auth){"use strict";var vm=this;vm.login=function(){$auth.login($scope.user).then(function(){$location.path("")})["catch"](function(error){})},vm.authenticate=function(provider){$auth.authenticate(provider).then(function(){$location.path("")})["catch"](function(error){$location.path("/logout")})},$scope.$on("$destroy",function(){vm=null,$scope=null})}function LogoutCtrl($scope,$location,$auth){"use strict";var vm=this;$auth.isAuthenticated()&&($auth.logout().then(function(){$location.path("/login")}),$scope.$on("$destroy",function(){vm=null,$scope=null}))}function MenuCtrl($scope,OrderStatusService){"use strict";var vm=this;vm.isMenuOpen=!1,vm.orderStatusService=OrderStatusService,$scope.$on("$destroy",function(){vm.clearAfterDestroy()}),vm.showHideMenu=function(){vm.isMenuOpen=!vm.isMenuOpen},vm.clearAfterDestroy=function(){vm=null,$scope=null}}function OrderFormCtrl($scope,OrderService,restaurantsData,userData,$auth,RestaurantService,OrderStatusService){"use strict";var vm=this;vm.orderService=OrderService,vm.orderStatusService=OrderStatusService,vm.restaurants=restaurantsData,vm.user=userData,vm.restaurantService=RestaurantService,vm.isAddOrderEnabled=!1,$scope.$watch("OrderFormCtrl.restaurantService.selectedMeal",function(){vm.restaurantService.selectedMeal&&(vm.isAddOrderEnabled=!0)},!0),$scope.$on("$destroy",function(){vm.clearAfterDestroy()}),vm.isAuthenticated=function(){return $auth.isAuthenticated()},vm.addOrder=function(){var order=vm.orderService.getNewOrder(),selectedMeal=vm.restaurantService.selectedMeal;order.user=vm.user,order.title=vm.restaurantService.selectedRestaurant.name+" - "+selectedMeal.name,order.price=selectedMeal.price,vm.orderService.addOrder(order)},vm.clearAfterDestroy=function(){vm=null,$scope=null}}function OrderListCtrl($scope,OrderService,ordersData,$auth,$state){"use strict";var vm=this,TAP_COMPLETED="completed",TAP_ACTIVE="active";vm.orderService=OrderService,vm.isAllCompleted=vm.orderService.isAllOrderCompleted(),vm.orders=ordersData,$scope.$watch("OrderListCtrl.orders",function(){vm.remainingCount=vm.orderService.getNumOfActive(),vm.completedCount=vm.orderService.getNumOfCompleted(),vm.isAllCompleted=vm.orderService.isAllOrderCompleted()},!0),$scope.$on("$stateChangeSuccess",function(){vm.status=$state.params.status||"",""===vm.status&&$state.go("home.list"),vm.statusFilter=vm.status===TAP_ACTIVE?{completed:!1}:vm.status===TAP_COMPLETED?{completed:!0}:{}}),$scope.$on("$destroy",function(){vm.clearAfterDestroy()}),vm.isActiveTap=function(){return vm.status===TAP_ACTIVE},vm.isCompletedTap=function(){return vm.status===TAP_COMPLETED},vm.isAuthenticated=function(){return $auth.isAuthenticated()},vm.clearAfterDestroy=function(){vm=null,$scope=null}}function OrderService(OrderStorage,StatusStorage,AccountService){"use strict";var newOrder={completed:!1,title:"",user:null,price:"",date:""},orders=null,_getCurrentDate=function(){var currentDate=new Date;return currentDate.setHours(0),currentDate.setMinutes(0),currentDate.setSeconds(0),currentDate.setMilliseconds(0),currentDate};return{getNewOrder:function(){return newOrder},loadOrders:function(){return null!==orders?orders:OrderStorage.get().then(function(ordersCollection){return orders=ordersCollection,ordersCollection.map(function(item){return item.date=new Date(item.date),item}),ordersCollection}.bind(this))},getOrders:function(){return orders},addOrder:function(newOrderItem){newOrderItem.title&&(newOrderItem.date=_getCurrentDate(),OrderStorage.insert(newOrderItem).then(function(){newOrder={completed:!1,title:"",user:null,price:"",date:""}}))},isUserOrderedToday:function(user){var response=orders.some(function(order){return order.user._id===user._id&&Number(order.date)===Number(_getCurrentDate())});return response},updateOrder:function(order){OrderStorage.put(order).then(function(){},function(){})},removeOrder:function(order){OrderStorage["delete"](order)},clearCompletedOrders:function(){OrderStorage.clearCompleted()},markAll:function(isCompletedAll){isCompletedAll?orders.forEach(function(order){order.completed=!1,this.updateOrder(order)},this):orders.forEach(function(order){order.completed||(order.completed=!0,this.updateOrder(order))},this)},isAllOrderCompleted:function(){var ordersCompleted=orders.filter(function(order){return order.completed===!0});return ordersCompleted.length===orders.length},getNumOfActive:function(){return orders.filter(function(order){return order.completed===!1}).length},getNumOfCompleted:function(){return orders.filter(function(order){return order.completed===!0}).length},updateListStatus:function(status){StatusStorage.put(status).then(function(){})},isOrderRemoveEnabled:function(order){}}}function OrderStatusService(StatusStorage){"use strict";var orderListStatus=0,STATUS_OPEN=0,STATUS_FINALIZED=1,STATUS_ORDERED=2,STATUS_DELIVERED=3;return{loadListStatus:function(){StatusStorage.get().then(function(status){return orderListStatus=status,status})},openOrdering:function(){orderListStatus=STATUS_OPEN,this.updateListStatus(STATUS_OPEN)},finalizedOrdering:function(){orderListStatus=STATUS_FINALIZED,this.updateListStatus(STATUS_FINALIZED)},orderedOrders:function(){orderListStatus=STATUS_ORDERED,this.updateListStatus(STATUS_ORDERED)},deliveredOrders:function(){orderListStatus=STATUS_DELIVERED,this.updateListStatus(STATUS_DELIVERED),this.markAll(!1)},isOrderActive:function(){return orderListStatus===STATUS_OPEN},isOrderFinalized:function(){return orderListStatus===STATUS_FINALIZED},isOrderOrdered:function(){return orderListStatus===STATUS_ORDERED},isOrderDelivered:function(){return orderListStatus===STATUS_DELIVERED}}}function RestaurantService(RestaurantStorage){"use strict";var restaurants=null,selectedMeal=null,selectedRestaurant=null;return{loadRestaurant:function(){return null!==restaurants?restaurants:RestaurantStorage.get().then(function(restaurantsCollection){return restaurants=restaurantsCollection,restaurantsCollection}.bind(this))},getSelectedRestaurant:function(){return selectedRestaurant},setSelectedRestaurant:function(selectedItem){selectedRestaurant=selectedItem},getSelectedMeal:function(){return selectedMeal},setSelectedMeal:function(selectedItem){selectedMeal=selectedItem}}}angular.module("orders",["ngRoute","ui.router","satellizer","ngMaterial","orders.routes","angular.filter"]).config(["$authProvider","$windowProvider",function($authProvider,$windowProvider){"use strict";$authProvider.github({clientId:"3532eda80a0f3b9f16a1",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:$windowProvider.$get().location.origin||$windowProvider.$get().location.protocol+"//"+$windowProvider.$get().location.host,optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}}),$authProvider.oauth2({name:"foursquare",url:"/auth/foursquare",clientId:"MTCEJ3NGW2PNNB31WOSBFDSAD4MTHYVAZ1UKIULXZ2CVFC2K",redirectUri:$windowProvider.$get().location.origin||$windowProvider.$get().location.protocol+"//"+$windowProvider.$get().location.host,authorizationEndpoint:"https://foursquare.com/oauth2/authenticate"}),$authProvider.baseUrl="http://localhost:3000",$authProvider.withCredentials=!1}]).config(["$mdThemingProvider",function($mdThemingProvider){"use strict";$mdThemingProvider.theme("default").primaryPalette("orange",{"default":"800"}).accentPalette("orange",{"default":"200"})}]),angular.module("orders.routes",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){"use strict";var loginRequired=function($q,$auth,$location){var deferred=$q.defer();return $auth.isAuthenticated()?deferred.resolve():$location.path("/login"),deferred.promise};loginRequired.$inject=["$q","$auth","$location"];var skipIfLoggedIn=function($q,$auth){var deferred=$q.defer();return $auth.isAuthenticated()?deferred.reject():deferred.resolve(),deferred.promise};skipIfLoggedIn.$inject=["$q","$auth"],$stateProvider.state("login",{url:"/login",templateUrl:"js/templates/login.html",controller:"LoginController as LoginCtrl",resolve:{skipIfLoggedIn:skipIfLoggedIn}}).state("logout",{url:"/logout",template:null,controller:"LogoutController as LogoutCtrl"}).state("home",{url:"",views:{"":{templateUrl:"./js/templates/home.html",controller:"OrderListController as OrderListCtrl",resolve:{loginRequired:loginRequired,ordersData:["OrderService",function(OrderService){return OrderService.loadOrders()}]}},"top@home":{templateUrl:"./js/templates/top.html",controller:"OrderFormController as OrderFormCtrl",resolve:{loginRequired:loginRequired,restaurantsData:["RestaurantService",function(RestaurantService){return RestaurantService.loadRestaurant()}],userData:["AccountService",function(AccountService){return AccountService.getUserData()}],listStatus:["OrderStatusService",function(OrderStatusService){OrderStatusService.loadListStatus()}]}},"menu@home":{templateUrl:"./js/templates/menu-top.html",controller:"MenuController as MenuCtrl"}}}).state("home.list",{url:"/",templateUrl:"./js/templates/order-list.html"}).state("home.active",{url:"/:status",templateUrl:"./js/templates/order-list.html"}).state("home.completed",{url:"/:status",templateUrl:"./js/templates/order-list.html"}),$urlRouterProvider.otherwise("")}]),angular.module("orders").factory("OrderStorage",["$q",OrderStorage]),angular.module("orders").factory("RestaurantStorage",["$q",RestaurantStorage]),angular.module("orders").factory("StatusStorage",["$q",StatusStorage]),angular.module("orders").factory("AccountModel",["$http",AccountModel]).factory("AccountService",["AccountModel",AccountService]),angular.module("orders").controller("LoginController",["$scope","$location","$auth",LoginCtrl]),angular.module("orders").controller("LogoutController",["$scope","$location","$auth",LogoutCtrl]),angular.module("orders").controller("MenuController",["$scope","OrderStatusService",MenuCtrl]),angular.module("orders").controller("OrderFormController",["$scope","OrderService","restaurantsData","userData","$auth","RestaurantService","OrderStatusService",OrderFormCtrl]),angular.module("orders").controller("OrderListController",["$scope","OrderService","ordersData","$auth","$state",OrderListCtrl]),angular.module("orders").factory("OrderService",["OrderStorage","StatusStorage","AccountService",OrderService]),angular.module("orders").factory("OrderStatusService",["StatusStorage",OrderStatusService]),angular.module("orders").factory("RestaurantService",["RestaurantStorage",RestaurantService]);
//# sourceMappingURL=src.js.map
